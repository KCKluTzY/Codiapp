spring:
  application:
    name: api-gateway
  
  main:
    web-application-type: reactive

  # Redis
  data:
    redis:
      host: ${REDIS_HOST}
      port: ${REDIS_PORT}
      password: ${REDIS_PASSWORD}
      timeout: 2000ms

  # Spring Cloud Gateway
  cloud:
    gateway:
      enabled: false

# Serveur
server:
  port: ${API_GATEWAY_PORT}

# gRPC Clients
grpc:
  client:
    auth-service:
      host: localhost
      port: ${AUTH_SERVICE_PORT}
    user-service:
      host: localhost
      port: ${USER_SERVICE_PORT}
    messaging-service:
      host: localhost
      port: ${MESSAGING_SERVICE_PORT}
    location-service:
      host: localhost
      port: ${LOCATION_SERVICE_PORT}
    alert-service:
      host: localhost
      port: ${ALERT_SERVICE_PORT}
    notification-service:
      host: localhost
      port: ${NOTIFICATION_SERVICE_PORT}

# JWT Configuration
jwt:
  secret: ${JWT_SECRET}
  header: Authorization
  prefix: "Bearer "

# Rate Limiting
rate-limit:
  enabled: true
  default:
    requests-per-second: 10
    burst-capacity: 200

# Matrice d'accès par rôle
security:
  # Routes publiques (pas de JWT requis)
  public-routes:
    - "/api/v1/auth/login"
    - "/api/v1/auth/register"
    - "/api/v1/auth/refresh"
    - "/api/v1/auth/forgot-password"
    - "/actuator/health"
  
  # Routes par rôle
  role-routes:
    ADMINISTRATOR:
      - "/api/v1/admin/**"
      - "/api/v1/users/all"
      - "/api/v1/users/*/role"
    
    HELPER:
      - "/api/v1/alerts/*/assign"
      - "/api/v1/alerts/*/resolve"
      - "/api/v1/helpers/availability"
    
    PERSON_DI:
      - "/api/v1/alerts/create"
      - "/api/v1/locations/share"
      - "/api/v1/helpers/available"

# Logging
logging:
  level:
    root: INFO
    com.codistrib.apigateway: DEBUG
    org.springframework.cloud.gateway: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# Actuator (Health Check)
management:
  endpoints:
    web:
      exposure:
        exclude: gateway

eureka:
  client:
    enabled: false